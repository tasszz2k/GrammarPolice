name: Build and Release

on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: macos-14
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: latest-stable
    
    - name: Build
      run: |
        xcodebuild -project GrammarPolice.xcodeproj \
          -scheme GrammarPolice \
          -configuration Release \
          -archivePath build/GrammarPolice.xcarchive \
          archive
    
    - name: Export App
      run: |
        xcodebuild -exportArchive \
          -archivePath build/GrammarPolice.xcarchive \
          -exportPath build/export \
          -exportOptionsPlist ExportOptions.plist
    
    - name: Create ZIP
      run: |
        cd build/export
        zip -r ../../GrammarPolice.zip GrammarPolice.app
    
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: GrammarPolice.zip
        generate_release_notes: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

